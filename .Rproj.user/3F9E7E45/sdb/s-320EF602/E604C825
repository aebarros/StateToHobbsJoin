{
    "collab_server" : "",
    "contents" : "library(plyr)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(reshape2)\nlibrary(purrr)\n\n#read in all the state MWT data\nstateMWTCatch<-read.table(\"data/stateMWT/stateMWTCatch.txt\",header=TRUE,sep=\"\\t\")\nstateMWTFishCodes<-read.table(\"data/stateMWT/stateMWTSpeciesCodes.txt\",header=TRUE,sep=\"\\t\")\nstateMWTNetCodes<-read.table(\"data/stateMWT/stateMWTNetCodes.txt\",header=TRUE,sep=\"\\t\")\nstateMWTStationsLookup<-read.table(\"data/stateMWT/stateMWTStationsLookup.txt\",header=TRUE,sep=\"\\t\")\nstateMWTWaterInfo<-read.table(\"data/stateMWT/stateMWTWaterInfo.txt\",header=TRUE,sep=\"\\t\")\nstateMWTVariableLookup<-read.table(\"data/stateMWT/stateMWTVariableLookup.txt\",header=TRUE,sep=\"\\t\")\n\nstr(stateMWTCatch)\nstr(stateMWTFishCodes)\nstr(stateMWTNetCodes)\nstr(stateMWTStationsLookup)\nstr(stateMWTWaterInfo)\nstr(stateMWTVariableLookup)\n\n#first off need to fix this god awful version of a lookup table\nhead(stateMWTVariableLookup)\n#look at that monstrosity^!!!!\n\n#first do a messy dcast to make it a wide format with each vector from one of the \"CodeListName\" groups\n#this is the best method I could think of\nstateMWTVariablesWide<-dcast(stateMWTVariableLookup, ValueCode~CodeListName)\n\n#next need to rename vectors to match with related vectors in the data tables because who ever made this has the\n#names for the codes different then what is used in the tables\nstr(stateMWTVariablesWide)\nhead(stateMWTVariablesWide)\nstateMWTVariablesWide<-rename(stateMWTVariablesWide,TideCode=TideCodeList)\n#Luckily all we really need is the TideCodes\nstateMWTTideCodes<-select(stateMWTVariablesWide, ValueCode, TideCode)\nstateMWTTideCodes<-rename(stateMWTTideCodes, TideCode=ValueCode, tidet=TideCode)\nhead(stateMWTTideCodes)\n\n#fix type in StationCode in stateMWTWaterInfo\nstateMWTWaterInfo$StationCode<-as.factor(stateMWTWaterInfo$StationCode)\n#fix tidecode type in stateMWTWaterInfo\nstateMWTWaterInfo$TideCode<-as.factor(stateMWTWaterInfo$TideCode)\n\n#the final joined table is too large! have to shave some of it down before joining\nstateMWTCatch<-select(stateMWTCatch, SampleRowID, OrganismCode, Catch)\nstateMWTWaterInfo<-select(stateMWTWaterInfo, -UserName, -TowDirectionCode, -CableOut, -MeterNumber,-WaveCode,-DateEntered)\nstateMWTStationsLookup<-select(stateMWTStationsLookup, -Active,-RKI,-Comments,-Channel.Shoal)\nstateMWTNetCodes<-select(stateMWTNetCodes, -NormalizedCode,-Active)\n\n#Lets join up the tables\nstateMWTdata<-stateMWTCatch%>%\n  full_join(stateMWTFishCodes)%>%\n  full_join(stateMWTWaterInfo)%>%\n  full_join(stateMWTNetCodes)%>%\n  full_join(stateMWTStationsLookup)%>%\n  full_join(stateMWTTideCodes)\nhead(stateMWTdata)\n\n#select relevant data\nstr(stateMWTdata)\nstateMWTselected<-select(stateMWTdata,-OrganismRowID,-Microcystis, -Active,-Phylum,-Class,-NameInSAS,-OrganismSymbol,-NormalizedCode,\n                         -SecchiEstimated, -TideCode,-MethodType,-SurveyNumber,-MethodName,-StationRowID,-Order,-AlternateName,-SampleTimeEnd,-Lat,-Long,-MethodRowID,-WeatherCode)\nstr(stateMWTselected)\nhead(stateMWTselected)\n\n#format Date\nstateMWTclean<-stateMWTselected\nstateMWTclean$SampleDate <- as.Date(stateMWTclean$SampleDate , \"%m/%d/%Y\")\nstateMWTclean<-stateMWTclean[order(as.Date(stateMWTclean$SampleDate, format=\"%m/%d/%Y\")),]\nhead(stateMWTclean)\n\n#restructure SampleTimeStart\nstateMWTclean$SampleTimeStart<-strptime(stateMWTclean$SampleTimeStart, \"%m/%d/%Y %H:%M:%S\")\nstateMWTclean$SampleTimeStart<-strftime(stateMWTclean$SampleTimeStart, format=\"%H:%M:%S\")\n\nstr(stateMWTclean)\n\n#rename vectors to match hobbs flatfile data\nstateMWTclean<-rename(stateMWTclean, id=SampleRowID, code=OrganismCode, Count=Catch, comname=CommonName, family=Family,\n                      genus=Genus, species=Species, notes=Comments, polystn=StationCode, Date=SampleDate, method=MethodCode,Time=SampleTimeStart,\n                      bstemp=WaterTemperature, bntu=Turbidity, bsecchi=Secchi, bscond=ConductivityTop, bbcond=ConductivityBottom,\n                      bflow=MeterStart, eflow=MeterEnd,depth=DepthBottom, loc=Location, lat=WGS84.Lat, long=WGS84.Long)\n#write TO rds, this is to make sure the formats stay the same, as saving as a txt doesn't save formats correctly\n#make sure to change the destination file path for your computer when doing this at home\nsaveRDS(stateMWTclean,file=\"C:\\\\Users\\\\hobbs\\\\Desktop\\\\R for work\\\\StateToHobbsDataClean\\\\data\\\\stateMWTclean.rds\")\n\n",
    "created" : 1504717465194.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3690161953",
    "id" : "E604C825",
    "lastKnownWriteTime" : 1504732736,
    "last_content_update" : 1504732736801,
    "path" : "C:/Users/hobbs/Desktop/R for work/StateToHobbsDataClean/data/cleanstateMWT.R",
    "project_path" : "data/cleanstateMWT.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}