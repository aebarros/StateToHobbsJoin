{
    "collab_server" : "",
    "contents" : "library(plyr)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(reshape2)\nlibrary(purrr)\n\n#read in all the state BayStudy data\nstateBSCatch<-read.table(\"data/stateBayStudy/stateBayStudyCatch.txt\",header=TRUE,sep=\"\\t\")\nstateBSFishCodes<-read.table(\"data/stateBayStudy/stateBayStudySpeciesCodes.txt\",header=TRUE,sep=\"\\t\")\nstateBSStations<-read.table(\"data/stateBayStudy/stateBayStudyStations.txt\",header=TRUE,sep=\"\\t\")\nstateBSSalinTemp<-read.table(\"data/stateBayStudy/stateBayStudySalinTemp.txt\",header=TRUE,sep=\"\\t\")\nstateBSDepthSecchi<-read.table(\"data/stateBayStudy/stateBayStudyMeters.txt\",header=TRUE,sep=\"\\t\")\nstateBSNetCodes<-read.table(\"data/stateBayStudy/stateBayStudyNetCodes.txt\",header=TRUE,sep=\"\\t\")\nstateBSLengths<-read.table(\"data/stateBayStudy/stateBayStudyLengths.txt\",header=TRUE,sep=\"\\t\")\nstateBSTides<-read.table(\"data/stateBayStudy/stateBayStudyTides.txt\",header=TRUE,sep=\"\\t\")\n\nstr(stateBSCatch)\nstr(stateBSFishCodes)\nstr(stateBSStations)\nstr(stateBSSalinTemp)\nstr(stateBSDepthSecchi)\nstr(stateBSNetCodes)\n\n#remove comments from stateBSDepthSecchi\nstateBSDepthSecchi<-select(stateBSDepthSecchi, -Comment,-Tide)\n\n#add id to Stations df to allow id of individual tows\nstateBSStations$id<-seq.int(nrow(stateBSStations))\n\n#join all the data\nstateBSdata<-stateBSCatch%>%\n  full_join(stateBSFishCodes)%>%\n  full_join(stateBSStations)%>%\n  full_join(stateBSSalinTemp)%>%\n  full_join(stateBSDepthSecchi)%>%\n  full_join(stateBSNetCodes)%>%\n  full_join(stateBSTides)\nstr(stateBSdata)\nhead(stateBSdata)\n\n#get catch counts because bay study doesn't put this most basic of measurements in their database\n#sum count from length data#\nhead(stateBSLengths)\ndata.lengthcount=stateBSLengths%>%\n  group_by_(\"Year\",\"Survey\",\"Station\",\"Net\",\"AlphaCode\")%>%\n  summarise(Catch=n())\nhead(data.lengthcount)\n\ndata.catch=stateBSCatch\n\n#join data.catch to data.lengthcount#\ntotal.catch=data.catch%>%\n  inner_join(data.lengthcount)\nhead(total.catch)\nstr(total.catch)\n\n#sum catch with pluscount, then divide by qtssubsampled and multiply by qts caught and round down#\ntotal.catch$TotalCatch<-((total.catch$Catch + total.catch$PlusCount)/total.catch$QtsSubsampled)*total.catch$QtsCaught\nhead(total.catch)\n\n#join total.catch to rest of data\nstateBSdata<-stateBSdata%>%\n  full_join(total.catch)\nhead(stateBSdata)\nstr(stateBSdata)\n\n#format Date\nstateBSdata$Date <- as.Date(stateBSdata$Date , \"%m/%d/%Y\")\n\n#select vectors to keep\nstateBSselected<-select(stateBSdata, Date, Time, Method, Station, Tow, AlphaCode, CommonName, Comments,\n                        Tide, Depth,Duration, StartMeter, EndMeter, TotalMeter, StartLat, StartLong, Distance, Comment, ECSurf,\n                        ECBott, TempSurf, TempBott, Secchi, TotalCatch, Description, ScientificName, Family, Method)\nhead(stateBSselected)\n\n#strip time data to HH:MM:SS\nstateBSclean<-stateBSselected\nstateBSclean$Time<-strptime(stateBSclean$Time, \"%m/%d/%Y %H:%M:%S\")\nstateBSclean$Time<-strftime(stateBSclean$Time, format=\"%H:%M:%S\")\nhead(stateBSclean)\nstr(stateBSclean)\n\n#split the ScientificName vector into two new columns \"genus\" and \"species\"\nstateBSclean$genus<- sapply(strsplit(as.character(stateBSclean$ScientificName),' '), \"[\", 1)\nstateBSclean$species <- sapply(strsplit(as.character(stateBSclean$ScientificName),' '), \"[\", 2)\n\n#rename vectors to match hobbs flatfile data\nstateBSclean<-rename(stateBSclean, polystn=Station, code=AlphaCode, comname=CommonName, notes=Comments, dur=Duration, tidet=Description,\n                     lat=StartLat, long=StartLong, dist=Distance, bflow=StartMeter, eflow=EndMeter, dflow=TotalMeter,\n                     bscond=ECSurf, depth=Depth,bbcond=ECBott, bstemp=TempSurf, bbtemp=TempBott, bsecchi=Secchi, Count=TotalCatch, gensp=ScientificName, family=Family,method=Method)\nstr(stateBSclean)\n\n\n\n#write TO rds, this is to make sure the formats stay the same, as saving as a txt doesn't save formats correctly\n#make sure to change the destination file path for your computer when doing this at home\nsaveRDS(stateBSclean,file=\"C:\\\\Users\\\\hobbs\\\\Desktop\\\\R for work\\\\StateToHobbsDataClean\\\\data\\\\stateBSclean.rds\")\n",
    "created" : 1504645301811.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3023664480",
    "id" : "2BB93F23",
    "lastKnownWriteTime" : 1504735402,
    "last_content_update" : 1504735402484,
    "path" : "C:/Users/hobbs/Desktop/R for work/StateToHobbsDataClean/data/cleanstateBayStudy.R",
    "project_path" : "data/cleanstateBayStudy.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}