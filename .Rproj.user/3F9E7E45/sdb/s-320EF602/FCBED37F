{
    "collab_server" : "",
    "contents" : "library(plyr)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(reshape2)\nlibrary(purrr)\n\n#read in all the state MWT data\nstateTNCatch<-read.table(\"data/stateTowNet/stateTowNetCatch.txt\",header=TRUE,sep=\"\\t\")\nstateTNSpeciesCodes<-read.table(\"data/stateTowNet/stateTowNetSpeciesCodes.txt\",header=TRUE,sep=\"\\t\")\nstateTNStations<-read.table(\"data/stateTowNet/stateTowNetStations.txt\",header=TRUE,sep=\"\\t\")\nstateTNTowEffort<-read.table(\"data/stateTowNet/stateTowNetTowEffort.txt\",header=TRUE,sep=\"\\t\")\nstateTNTowInfo<-read.table(\"data/stateTowNet/stateTowNetTowInfo.txt\",header=TRUE,sep=\"\\t\")\nstateTNTide<-read.table(\"data/stateTowNet/stateTowNetTide.txt\",header=TRUE,sep=\"\\t\")\n\nstr(stateTNCatch)\nstr(stateTNSpeciesCodes)\nstr(stateTNStations)\nstr(stateTNTowEffort)\nstr(stateTNTowInfo)\nstr(stateTNTide)\n\n#rename ORganismtCode in SpeciesCodes\nstateTNSpeciesCodes<-rename(stateTNSpeciesCodes, OrganismCode=OrganismCodeSTN)\nstateTNStations<-rename(stateTNStations, StationCode=StationCodeSTN)\n\n#getting memory allocation errors so have to lessen amount of data?\nstateTNCatch<-select(stateTNCatch, -CatchRowID)\nstateTNSpeciesCodes<-select(stateTNSpeciesCodes, -OrganismRowID,-OrganismCodeMaster,-CommonNameMaster,-FieldNameMWT,-FieldNameSTN,\n                            -OrganismCodeMWT,-OrganismSymbol,-Active,-Phylum,-Class,-Order)\nstateTNStations<-select(stateTNStations,-StationRowID,-Active,-Core,-Index,-RKI,-TNS.Diet.Area,-STRArea,-WeightingFactor,\n                        -YearAdded,-YearEliminated)\nstateTNTowInfo<-select(stateTNTowInfo,-UserName,-Survey,-Weather,-Waves,-StartLatDegrees,-StartLatMinutes,-StartLatSeconds,\n                       -StartLongDegrees,-StartLongMinutes,-StartLongSeconds,-EndLatDegrees,-EndLatMinutes,-EndLatSeconds,\n                       -EndLongDegrees,-EndLongMinutes,-EndLongSeconds)\n\n#Lets join up the tables\nstateTNdata<-stateTNTowInfo%>%\n  full_join(stateTNTowEffort)%>%\n  full_join(stateTNCatch)%>%\n  full_join(stateTNSpeciesCodes)%>%\n  full_join(stateTNStations)%>%\n  full_join(stateTNTide)\nhead(stateTNdata)\nstr(stateTNdata)\n\n#format gps because state lat long is in a ridiculous format seperated out as seperate vectors each for Degree, Minute and Second\n#Who in their right mind structures gps coordinates like this without having two vectors for just lat and long?\nsapply(stateTNdata,class)\n#transform into decimal degrees\nstateTNdata$LatS<-stateTNdata$LatS/3600\nstateTNdata$LatM<-stateTNdata$LatM/60\nstateTNdata$LonS<-stateTNdata$LonS/3600\nstateTNdata$LonM<-stateTNdata$LonM/60\n#add minutes and seconds together\nstateTNdata$LatMS<-stateTNdata$LatM+stateTNdata$LatS\nstateTNdata$LonMS<-stateTNdata$LonM+stateTNdata$LonS\n#combine data\nstateTNdata$Latitude <- paste(stateTNdata$LatD,stateTNdata$LatMS)\nstateTNdata$Longitude <- paste(stateTNdata$LonD,stateTNdata$LonMS)\nhead(stateTNdata)\n#remove spaces and first zero, replace with Â°\nstateTNdata$Latitude <- gsub(\" 0.\", \".\", stateTNdata$Latitude)\nstateTNdata$Longitude <- gsub(\" 0.\", \".\", stateTNdata$Longitude)\nhead(stateTNdata)\n#add \"-\" infront of all longitude\nstateTNdata$negative <- rep(\"-\",nrow(stateTNdata)) # make new column \nstateTNdata$Longitude<-paste(stateTNdata$negative, stateTNdata$Longitude)\nstateTNdata$Longitude <- gsub(\" \", \"\", stateTNdata$Longitude)\nhead(stateTNdata)\n#transform Lat and Long to numeric\nstateTNdata<-transform(stateTNdata, Latitude = as.numeric(Latitude), Longitude = as.numeric(Longitude))\nhead(stateTNdata)\nstr(stateTNdata)\n\n#drop some of the LatLon columns\nstateTNdata<-select(stateTNdata,-LatD,-LatM,-LatS,-LonD,-LonM,-LonS,-LatMS,-LonMS,-negative)\nhead(stateTNdata)\n\n#format Date\nstateTNclean<-stateTNdata\nstateTNclean$SampleDate <- as.Date(stateTNclean$SampleDate , \"%m/%d/%Y\")\n#restructure SampleTimeStart\nstateTNclean$TimeStart<-strptime(stateTNclean$TimeStart, \"%m/%d/%Y %H:%M:%S\")\nstateTNclean$TimeStart<-strftime(stateTNclean$TimeStart, format=\"%H:%M:%S\")\n\n#select needed vectors\nstr(stateTNclean)\nstateTNclean<-select(stateTNclean, -CableOut,-TowDirection,-WindDirection,-Microcystis,-TowRowID,-TimeStop,\n                     -MeterSerial,-TowComments,-MeterEstimate,-AreaCode,-Comments,-TideCode)\n\n#rename vectors to match hobbs flatfile data\nstateTNclean<-rename(stateTNclean, id=SampleRowID, Date=SampleDate, polystn=StationCode,bstemp=TemperatureTop,\n                     bbtemp=TemperatureBottom, bsecchi=Secchi, bscond=ConductivityTop, bbcond=ConductivityBottom,\n                     depth=DepthBottom, notes=SampleComments, bntu=TurbidityTop, rep=TowNumber, Time=TimeStart,\n                     bflow=MeterIn, eflow=MeterOut, dflow=MeterDifference, code=OrganismCode, Count=Catch,\n                     comname=CommonName, family=Family, genus=Genus, species=Species, region=Region, loc=Location,\n                     tidet=TideDesc, lat=Latitude, long=Longitude)\n\n#write TO rds, this is to make sure the formats stay the same, as saving as a txt doesn't save formats correctly\n#make sure to change the destination file path for your computer when doing this at home\nsaveRDS(stateTNclean,file=\"C:\\\\Users\\\\hobbs\\\\Desktop\\\\R for work\\\\StateToHobbsDataClean\\\\data\\\\stateTNclean.rds\")\n",
    "created" : 1504729875488.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "464136534",
    "id" : "FCBED37F",
    "lastKnownWriteTime" : 1504733627,
    "last_content_update" : 1504733627337,
    "path" : "C:/Users/hobbs/Desktop/R for work/StateToHobbsDataClean/cleanstateTN.R",
    "project_path" : "cleanstateTN.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}